<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/mermaid/0.5.5/mermaid.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/0.5.5/mermaid.min.js"></script>
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# e2eテスト勉強会 

---

# アジェンダ

1. 理論的な部分を知る (30min)
  1. テストの種類
  2. 開発ライフサイクル
2. PageObjectの設計＆実装編 (残り時間)
  1. PageObjectを考える。
  2. PageObjectのIF設計と実装
  3. 最初のServiceを作る
  4. Serviceを動くか確認する。
  5. (とりあえず)シナリオを作る

---

## テストの種類

今回勉強会で出てくる用語集的な意味で、テストの説明をします。

### Functional Test
### Smoke Test
### Intagration Test
### Regresion Test

---

### Functionalテスト

機能テスト、観点としては「画面が正しく動いているか」を見る。
例えば、そのボタンは目的の画面に遷移するか？、テキストボックスのバリデーションや入力値反映が動いているかなど。


### Smokeテスト

サービスの安易テスト：作ったサービスやストーリーが正しく動いてるかを軽く確認するテスト。ざっくり結合とも言う。
例えば、今回のストーリーを一通りこなして変化した部分が、ちゃんと実装に反映しているかを見る。Functionalテストをやっている場合はFunctionalテストと同じ事はしない。

---

### Intagrationテスト

サービスの綿密なテスト：作ったサービスやストーリーが正しく動いているかを綿密にテストする。現プロジェクトではやらない。


### Regresionテスト

回忌テスト：デグレードが発生していないか、ある程度の周期で決められたタイミングに行うテスト。ここを楽にするために自動テストを行う。
回忌テストでは「リグレッションのシナリオを人間が行う」と「自動化されれたすべてのテスト」を行い、その両方を含めた観点でテストケースが管理できていると良い。

---

### テストのワークフロー

<div class="mermaid">
graph LR
  dis[設計]-->impl[実装]
  subgraph 実装
    impl---ut[単体テスト]
  end
  ut-->it[結合テスト]
  ut-->st[smokeテスト]

  ut==>rt[回帰テスト]
  st==>rt
</div>

---

## PageObjectを考える

一般的には....
 
 1. ユースケースから作成する方法

 1. I/Oベースで考える方法

---

## PageObjectのIF設計と実装

### ユースケースから作成する方法(1/2)

ユーザーアクションを抽出する。

<div class="mermaid">
graph LR
  uk(ログイン)-->ni(名前を入れる)
  uk-->pw(パスワードを入れる)
  uk-->bt(ログインボタンを押す)
</div>

---

### ユースケースから作成する方法(2/2)

ユーザーアクションを抽出する。

<div class="mermaid">
graph LR
  uk(ログイン)-->ni(名前を入れる)
  uk-->pw(パスワードを入れる)
  uk-->bt(ログインボタンを押す)
  ni-->a[IDで使えない文字]
  bt-->d[通信系error]
  bt-->e[業務系error]
  d-->f(共通エラーコンポーネント)
  e-->f
</div>


---

### ユースケースからサービスを追加する場合

存在するElementの組み合わせで出来る事を纏める。
観点は「何がしたいのか？」

<div class="mermaid">
graph LR
  uk(ログイン)-->ni(名前を入れる)
  uk-->pw(パスワードを入れる)
  uk-->bt(ログインボタンを押す)
  ni==>login(ログインに成功する)
  pw==>login
  bt==>login
  ni-.->loginE(ログインに失敗する)
  pw-.->loginE
  bt-.->loginE
</div>

---

### I/Oベースで考える方法

既に画面がある、もしくはイメージできている場合に有用。

I(入力), O(出力), IO(入出力)、EO(エラー出力)の４つに分ける。

---

<div class="mermaid">
graph LR
  i(入力)-->nm(名前を入れる)
  i-->pw(パスワードを入れる)
  i-->bt(ログインボタンを押す)
  o(出力)-->無し
  eio-->nme(ID入力エラー)
  nm-.->nme
  eio(Err出力)-->bteA(通信エラー)
  nm-.->bteA
  eio-->bteB(業務エラー)
  nm-.->bteB
  io(入出力)-->non(無し)
</div>

---

## Elementを作る

```javascript
'use strict';

/**
* ログイン画面
* @example
* kacTest.po.common.login;
*/
export default class Login{
  constructor() {
    /** ユーザーID */
    this.inputUserId = element(by.css('xxxxxxxx'));
    /** ユーザーIDのバリデータ */
    this.validUserId = element(by.css('xxxxxxxx'));
    /** パスワード */
    this.inputPassword = element(by.css('xxxxxxxx'));
    /** ログインボタン */
    this.btnLogin = element(by.css('xxxxxxxx'));
    /** ログインボタン押下時のバリデータ */
    this.validLogin = element(by.css('xxxxxxxx'));
  }
}

```

---

## Verificationを作る

```javascript

 /**
  * 画面が描画されたかを確認する。
  * @example
  * // promise chain.
  *   .then(()=> kacTest.po.iaasOrder.advancedfirewalloption.verification())
  *
  * @return {Promise}
  */
  verification() {
    return kacTest.helper.po.createVerification([
      this.lnkJsocUnUse,
      this.lnkPageBack,
    ]);
  }

```

---

## 最初のServiceを作る

```javascript

  /**
  * ログインを行いXXページへ移る
  * @example
  * // promise chain.
  *   .then(()=> kacTest.po.common.login.login('hoge','passwd'))
  *
  * @param {string} user ユーザーID
  * @param {string} pass パスワード
  * @return {Promise}
  */
  login(user, pass) {
    return browser.get('http://localhost:9999/')
      .then(()=> then.inputUserId.sendKeys(user))
      .then(()=> then.inputPassword.sendKeys(user))
      .then(()=> then.btnLogin.click())
  }
}

```

---

## Serviceを動くか確認する。

```javascript
'use strict';

describe('ログイン', function() {
  it('ページからログインできる事', done=> {
    return kacTest.capture.take('テスト開始')
      .then(()=> kacTest.po.common.login.login('hoge','passwd'))
      .then(()=> kacTest.po.common.topPage.verification())
      .then(()=> kacTest.capture.take('ログイン完了'))
      .then(()=> done());
  });
});

```

---

### 形作り

 1. elementを作る
 2. serviceを作る
 3. serviceが動くかspecで確認する
 4. 2と3を繰り返す
 5. 十分serviceが出来るとシナリオを考える
 6. シナリオをスペックに実装する。


    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
